<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>flights ✈</title>
    <meta name="title" content="flights ✈" />
    <meta name="description" content="shagun's flight map" />

    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://shag.lol/flights/" />
    <meta property="og:title" content="flights ✈" />

    <link rel="icon" href="../1.png">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <style>
        :root {
            --glass-card: rgba(20, 28, 40, 0.65);
            --glass-button: rgba(255, 255, 255, 0.08);
            --glass-button-border: rgba(255, 255, 255, 0.12);
            --text-primary: #ffffff;
            --text-secondary: rgba(255, 255, 255, 0.6);
            --accent: #64b5f6;
        }

        @media (prefers-color-scheme: light) {
            :root {
                --glass-card: rgba(245, 245, 245, 0.75);
                --glass-button: rgba(255, 255, 255, 0.5);
                --glass-button-border: rgba(255, 255, 255, 0.6);
                --text-primary: #37474f;
                --text-secondary: rgba(55, 71, 79, 0.6);
                --accent: #1976d2;
            }
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            margin: 0; padding: 0;
            height: 100dvh; width: 100vw;
            display: flex; justify-content: center; align-items: center;
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", sans-serif;
            background-color: #0a0e14; overflow: hidden;
        }

        @media (prefers-color-scheme: light) {
            body { background-color: #e8e8e8; }
        }

        .dashboard {
            width: 100%; height: 100%;
            max-width: 500px; max-height: 920px;
            background: var(--glass-card);
            backdrop-filter: blur(40px) saturate(150%);
            -webkit-backdrop-filter: blur(40px) saturate(150%);
            display: flex; flex-direction: column;
            animation: fadeIn 0.8s ease-out;
            overflow: hidden;
        }

        @media (min-width: 600px) {
            .dashboard {
                border-radius: 44px;
                height: 95%;
                box-shadow: 0 25px 80px rgba(0,0,0,0.4), inset 0 0 0 1px rgba(255,255,255,0.05);
            }
        }

        header {
            display: flex; justify-content: space-between; align-items: center;
            padding: 24px 28px 16px;
            position: relative; z-index: 10;
        }

        .back-link {
            font-size: 0.9rem;
            color: var(--text-secondary);
            text-decoration: none;
            opacity: 0.8;
            transition: opacity 0.2s;
        }
        .back-link:hover { opacity: 1; }

        .title {
            font-family: "Georgia", serif;
            font-size: 1.1rem;
            font-weight: 400;
            color: var(--text-primary);
            opacity: 0.9;
        }

        .map-container {
            flex: 1;
            min-height: 300px;
            position: relative;
            margin: 0 20px;
            border-radius: 20px;
            overflow: hidden;
        }

        #map {
            width: 100%; height: 100%;
            background: #1a1a2e;
        }

        .leaflet-container {
            background: #1a1a2e;
            font-family: inherit;
        }

        .content {
            padding: 20px 28px 32px;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }

        .stat {
            text-align: center;
            padding: 16px 8px;
            background: var(--glass-button);
            border: 1px solid var(--glass-button-border);
            border-radius: 16px;
        }
        .stat-value {
            font-size: 1.4rem;
            font-weight: 600;
            color: var(--text-primary);
        }
        .stat-label {
            font-size: 0.7rem;
            color: var(--text-secondary);
            margin-top: 4px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .flights-list {
            max-height: 180px;
            overflow-y: auto;
            padding-right: 8px;
        }
        .flights-list::-webkit-scrollbar {
            width: 4px;
        }
        .flights-list::-webkit-scrollbar-thumb {
            background: var(--text-secondary);
            border-radius: 2px;
        }

        .flight-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid var(--glass-button-border);
        }
        .flight-item:last-child { border-bottom: none; }

        .flight-route {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .flight-code {
            font-weight: 600;
            font-size: 0.95rem;
            color: var(--text-primary);
        }
        .flight-arrow {
            color: var(--accent);
            font-size: 0.8rem;
        }
        .flight-date {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                transition-duration: 0.01ms !important;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <header>
            <a href="../me/" class="back-link">← back</a>
            <div class="title">Flights</div>
            <div style="width: 50px;"></div>
        </header>

        <div class="map-container">
            <div id="map"></div>
        </div>

        <div class="content">
            <div class="stats">
                <div class="stat">
                    <div class="stat-value" id="total-flights">0</div>
                    <div class="stat-label">Flights</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="total-miles">0</div>
                    <div class="stat-label">Miles</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="total-airports">0</div>
                    <div class="stat-label">Airports</div>
                </div>
            </div>

            <div class="flights-list" id="flights-list">
                <!-- Flights populated by JS -->
            </div>
        </div>
    </div>

    <script>
        // Airport coordinates database
        const airports = {
            // US - California
            'SFO': { lat: 37.6213, lon: -122.3790, city: 'San Francisco' },
            'LAX': { lat: 33.9425, lon: -118.4081, city: 'Los Angeles' },
            'SJC': { lat: 37.3639, lon: -121.9289, city: 'San Jose' },
            'OAK': { lat: 37.7213, lon: -122.2208, city: 'Oakland' },
            'SAN': { lat: 32.7338, lon: -117.1933, city: 'San Diego' },
            'SNA': { lat: 33.6757, lon: -117.8678, city: 'Orange County' },
            'ONT': { lat: 34.0560, lon: -117.6012, city: 'Ontario' },
            'SBA': { lat: 34.4262, lon: -119.8405, city: 'Santa Barbara' },
            // US - East Coast
            'JFK': { lat: 40.6413, lon: -73.7781, city: 'New York' },
            'EWR': { lat: 40.6895, lon: -74.1745, city: 'Newark' },
            'BOS': { lat: 42.3656, lon: -71.0096, city: 'Boston' },
            'DCA': { lat: 38.8512, lon: -77.0402, city: 'Washington DC' },
            'IAD': { lat: 38.9531, lon: -77.4565, city: 'Dulles' },
            'MIA': { lat: 25.7959, lon: -80.2870, city: 'Miami' },
            'ATL': { lat: 33.6407, lon: -84.4277, city: 'Atlanta' },
            // US - Central
            'ORD': { lat: 41.9742, lon: -87.9073, city: 'Chicago' },
            'MDW': { lat: 41.7868, lon: -87.7522, city: 'Chicago Midway' },
            'DFW': { lat: 32.8998, lon: -97.0403, city: 'Dallas' },
            'DEN': { lat: 39.8561, lon: -104.6737, city: 'Denver' },
            'MSP': { lat: 44.8848, lon: -93.2223, city: 'Minneapolis' },
            'AUS': { lat: 30.1975, lon: -97.6664, city: 'Austin' },
            'PHX': { lat: 33.4373, lon: -112.0078, city: 'Phoenix' },
            'LAS': { lat: 36.0840, lon: -115.1537, city: 'Las Vegas' },
            // US - Pacific Northwest
            'SEA': { lat: 47.4502, lon: -122.3088, city: 'Seattle' },
            'PDX': { lat: 45.5898, lon: -122.5951, city: 'Portland' },
            // US - Hawaii
            'HNL': { lat: 21.3187, lon: -157.9225, city: 'Honolulu' },
            'KOA': { lat: 19.7388, lon: -156.0456, city: 'Kona' },
            'LIH': { lat: 21.9760, lon: -159.3390, city: 'Lihue' },
            // Canada
            'YVR': { lat: 49.1967, lon: -123.1815, city: 'Vancouver' },
            'YYZ': { lat: 43.6777, lon: -79.6248, city: 'Toronto' },
            // UK
            'LHR': { lat: 51.4700, lon: -0.4543, city: 'London Heathrow' },
            'LGW': { lat: 51.1537, lon: -0.1821, city: 'London Gatwick' },
            'STN': { lat: 51.8860, lon: 0.2389, city: 'London Stansted' },
            // Europe
            'CDG': { lat: 49.0097, lon: 2.5479, city: 'Paris' },
            'AMS': { lat: 52.3105, lon: 4.7683, city: 'Amsterdam' },
            'FRA': { lat: 50.0379, lon: 8.5622, city: 'Frankfurt' },
            'MUC': { lat: 48.3537, lon: 11.7750, city: 'Munich' },
            'ZRH': { lat: 47.4647, lon: 8.5492, city: 'Zurich' },
            'VIE': { lat: 48.1103, lon: 16.5697, city: 'Vienna' },
            'MXP': { lat: 45.6306, lon: 8.7281, city: 'Milan Malpensa' },
            'LIN': { lat: 45.4491, lon: 9.2783, city: 'Milan Linate' },
            'FCO': { lat: 41.8003, lon: 12.2389, city: 'Rome' },
            'BCN': { lat: 41.2974, lon: 2.0833, city: 'Barcelona' },
            'MAD': { lat: 40.4983, lon: -3.5676, city: 'Madrid' },
            'LIS': { lat: 38.7756, lon: -9.1354, city: 'Lisbon' },
            'DUB': { lat: 53.4264, lon: -6.2499, city: 'Dublin' },
            'CPH': { lat: 55.6180, lon: 12.6508, city: 'Copenhagen' },
            'ARN': { lat: 59.6498, lon: 17.9238, city: 'Stockholm' },
            'HEL': { lat: 60.3172, lon: 24.9633, city: 'Helsinki' },
            'OSL': { lat: 60.1976, lon: 11.1004, city: 'Oslo' },
            'PRG': { lat: 50.1008, lon: 14.2632, city: 'Prague' },
            'BUD': { lat: 47.4298, lon: 19.2611, city: 'Budapest' },
            'BEG': { lat: 44.8184, lon: 20.3091, city: 'Belgrade' },
            'OTP': { lat: 44.5711, lon: 26.0850, city: 'Bucharest' },
            'IST': { lat: 41.2753, lon: 28.7519, city: 'Istanbul' },
            // Middle East
            'DXB': { lat: 25.2532, lon: 55.3657, city: 'Dubai' },
            'DOH': { lat: 25.2609, lon: 51.6138, city: 'Doha' },
            // Asia - Japan
            'NRT': { lat: 35.7720, lon: 140.3929, city: 'Tokyo Narita' },
            'HND': { lat: 35.5494, lon: 139.7798, city: 'Tokyo Haneda' },
            // Asia - China/HK/Korea
            'HKG': { lat: 22.3080, lon: 113.9185, city: 'Hong Kong' },
            'ICN': { lat: 37.4602, lon: 126.4407, city: 'Seoul' },
            'PEK': { lat: 40.0799, lon: 116.6031, city: 'Beijing' },
            'PVG': { lat: 31.1443, lon: 121.8083, city: 'Shanghai' },
            // Asia - Southeast
            'SIN': { lat: 1.3644, lon: 103.9915, city: 'Singapore' },
            'BKK': { lat: 13.6900, lon: 100.7501, city: 'Bangkok' },
            'KUL': { lat: 2.7456, lon: 101.7072, city: 'Kuala Lumpur' },
            // Asia - India
            'DEL': { lat: 28.5562, lon: 77.1000, city: 'Delhi' },
            'BOM': { lat: 19.0896, lon: 72.8656, city: 'Mumbai' },
            'LKO': { lat: 26.7606, lon: 80.8893, city: 'Lucknow' },
            'IDR': { lat: 22.7218, lon: 75.8011, city: 'Indore' },
            // Other
            'SYD': { lat: -33.9399, lon: 151.1753, city: 'Sydney' },
            'MEX': { lat: 19.4363, lon: -99.0721, city: 'Mexico City' },
            'GRU': { lat: -23.4356, lon: -46.4731, city: 'São Paulo' },
            'CPT': { lat: -33.9715, lon: 18.6021, city: 'Cape Town' },
        };

        // Your flights from Flighty export
        const flights = [
            { from: 'SFO', to: 'EWR', date: '2018-06-21', flight: 'UA1720' },
            { from: 'SFO', to: 'HKG', date: '2018-07-14', flight: 'CX873' },
            { from: 'HKG', to: 'DEL', date: '2018-07-15', flight: 'CX695' },
            { from: 'DEL', to: 'HKG', date: '2018-08-10', flight: 'CX694' },
            { from: 'HKG', to: 'SFO', date: '2018-08-10', flight: 'CX892' },
            { from: 'SFO', to: 'YVR', date: '2019-08-23', flight: 'UA460' },
            { from: 'YVR', to: 'DEL', date: '2019-08-24', flight: 'UA8095' },
            { from: 'DEL', to: 'LKO', date: '2019-08-25', flight: 'VT641' },
            { from: 'DEL', to: 'EWR', date: '2019-09-19', flight: 'UA83' },
            { from: 'EWR', to: 'SFO', date: '2019-09-20', flight: 'UA497' },
            { from: 'SFO', to: 'DEN', date: '2020-10-10', flight: 'F9662' },
            { from: 'DEN', to: 'DFW', date: '2020-10-10', flight: 'F9262' },
            { from: 'DFW', to: 'DEN', date: '2020-10-12', flight: 'F9263' },
            { from: 'DEN', to: 'SFO', date: '2020-10-12', flight: 'F9663' },
            { from: 'SFO', to: 'DXB', date: '2021-08-07', flight: 'EK226' },
            { from: 'DXB', to: 'DEL', date: '2021-08-08', flight: 'EK512' },
            { from: 'DEL', to: 'LKO', date: '2021-08-09', flight: 'AI411' },
            { from: 'LKO', to: 'DEL', date: '2021-08-25', flight: 'AI432' },
            { from: 'DEL', to: 'DXB', date: '2021-08-26', flight: 'EK513' },
            { from: 'DXB', to: 'SFO', date: '2021-08-26', flight: 'EK225' },
            { from: 'SBA', to: 'LAX', date: '2021-11-10', flight: 'UA5596' },
            { from: 'LAX', to: 'SFO', date: '2021-11-10', flight: 'UA501' },
            { from: 'SFO', to: 'JFK', date: '2022-06-14', flight: 'UA520' },
            { from: 'EWR', to: 'DEL', date: '2022-06-14', flight: 'UA82' },
            { from: 'IDR', to: 'LKO', date: '2022-07-01', flight: '6E7127' },
            { from: 'DEL', to: 'ORD', date: '2022-07-14', flight: 'UA713' },
            { from: 'ORD', to: 'SFO', date: '2022-07-14', flight: 'UA2080' },
            { from: 'SFO', to: 'LAX', date: '2022-08-25', flight: 'DL2362' },
            { from: 'LAX', to: 'SFO', date: '2022-08-25', flight: 'UA1597' },
            { from: 'SFO', to: 'KOA', date: '2022-12-25', flight: 'UA1723' },
            { from: 'KOA', to: 'SFO', date: '2022-12-30', flight: 'UA1724' },
            { from: 'SFO', to: 'LHR', date: '2023-02-16', flight: 'UA901' },
            { from: 'SFO', to: 'DXB', date: '2023-02-16', flight: 'EK226' },
            { from: 'LHR', to: 'BOM', date: '2023-02-17', flight: 'UA8082' },
            { from: 'BOM', to: 'LKO', date: '2023-02-18', flight: 'AI689' },
            { from: 'DXB', to: 'LKO', date: '2023-02-18', flight: 'EK2242' },
            { from: 'LKO', to: 'BOM', date: '2023-03-02', flight: 'AI626' },
            { from: 'BOM', to: 'MUC', date: '2023-03-03', flight: 'LH767' },
            { from: 'MUC', to: 'SFO', date: '2023-03-03', flight: 'LH458' },
            { from: 'LKO', to: 'DEL', date: '2023-03-10', flight: 'VT642' },
            { from: 'DEL', to: 'DXB', date: '2023-03-10', flight: 'EK515' },
            { from: 'DXB', to: 'SFO', date: '2023-03-11', flight: 'EK225' },
            { from: 'LAX', to: 'SFO', date: '2023-03-22', flight: 'DL2985' },
            { from: 'SFO', to: 'EWR', date: '2023-10-23', flight: 'AS374' },
            { from: 'JFK', to: 'SFO', date: '2023-10-30', flight: 'DL884' },
            { from: 'SFO', to: 'ICN', date: '2023-12-12', flight: 'DL7861' },
            { from: 'ICN', to: 'DEL', date: '2023-12-14', flight: 'DL9028' },
            { from: 'DEL', to: 'ICN', date: '2023-12-25', flight: 'DL9029' },
            { from: 'ICN', to: 'SFO', date: '2023-12-26', flight: 'DL7860' },
            { from: 'SNA', to: 'SFO', date: '2024-01-29', flight: 'AS3494' },
            { from: 'SFO', to: 'LAX', date: '2024-06-13', flight: 'UA1260' },
            { from: 'SFO', to: 'LAX', date: '2024-06-24', flight: 'JL7555' },
            { from: 'LAX', to: 'HND', date: '2024-06-25', flight: 'JL7015' },
            { from: 'HND', to: 'DEL', date: '2024-06-26', flight: 'JL39' },
            { from: 'SFO', to: 'IST', date: '2024-07-11', flight: '6E4273' },
            { from: 'IST', to: 'DEL', date: '2024-07-12', flight: '6E12' },
            { from: 'DEL', to: 'LKO', date: '2024-07-13', flight: '6E5081' },
            { from: 'DEL', to: 'HND', date: '2024-07-18', flight: 'JL30' },
            { from: 'HND', to: 'SFO', date: '2024-07-27', flight: 'JL2' },
            { from: 'NRT', to: 'HNL', date: '2024-07-27', flight: 'HA822' },
            { from: 'HNL', to: 'OAK', date: '2024-07-27', flight: 'HA48' },
            { from: 'ONT', to: 'SFO', date: '2024-11-17', flight: 'F92677' },
            { from: 'SFO', to: 'DEN', date: '2024-11-21', flight: 'UA2676' },
            { from: 'DEN', to: 'EWR', date: '2024-11-21', flight: 'UA2058' },
            { from: 'SFO', to: 'FRA', date: '2024-11-21', flight: 'UA58' },
            { from: 'EWR', to: 'MXP', date: '2024-11-21', flight: 'UA19' },
            { from: 'FRA', to: 'LIN', date: '2024-11-22', flight: 'LH5668' },
            { from: 'MXP', to: 'ZRH', date: '2024-12-03', flight: 'LX1613' },
            { from: 'ZRH', to: 'SFO', date: '2024-12-03', flight: 'UA9728' },
            { from: 'SFO', to: 'SAN', date: '2025-03-27', flight: 'WN1650' },
            { from: 'SAN', to: 'SFO', date: '2025-04-01', flight: 'WN3914' },
            { from: 'SFO', to: 'LAX', date: '2025-05-09', flight: 'WN823' },
            { from: 'LAX', to: 'LGW', date: '2025-05-09', flight: 'U2712' },
            { from: 'STN', to: 'BUD', date: '2025-05-11', flight: 'FR3592' },
            { from: 'PRG', to: 'LHR', date: '2025-05-17', flight: 'BA861' },
            { from: 'LGW', to: 'LAX', date: '2025-05-18', flight: 'U2711' },
            { from: 'SNA', to: 'SFO', date: '2025-05-19', flight: 'F93581' },
            { from: 'OAK', to: 'LIH', date: '2025-05-21', flight: 'HA667' },
            { from: 'LIH', to: 'HNL', date: '2025-05-21', flight: 'HA184' },
            { from: 'HNL', to: 'SFO', date: '2025-05-26', flight: 'AS8124' },
            { from: 'HNL', to: 'SFO', date: '2025-05-27', flight: 'UA1141' },
            { from: 'SFO', to: 'SAN', date: '2025-06-19', flight: 'AS3310' },
            { from: 'SNA', to: 'SFO', date: '2025-06-22', flight: 'F93581' },
            { from: 'SFO', to: 'PHX', date: '2025-07-02', flight: 'AA1914' },
            { from: 'PHX', to: 'EWR', date: '2025-07-02', flight: 'AA2156' },
            { from: 'SFO', to: 'JFK', date: '2025-07-04', flight: 'DL365' },
            { from: 'DCA', to: 'MDW', date: '2025-07-12', flight: 'WN2295' },
            { from: 'MDW', to: 'SJC', date: '2025-07-12', flight: 'WN3917' },
            { from: 'SNA', to: 'SFO', date: '2025-09-08', flight: 'F93581' },
            { from: 'SFO', to: 'SAN', date: '2025-09-18', flight: 'AS912' },
            { from: 'ONT', to: 'SFO', date: '2025-09-22', flight: 'F92677' },
            { from: 'SFO', to: 'LHR', date: '2025-11-23', flight: 'BA284' },
            { from: 'LHR', to: 'BUD', date: '2025-11-24', flight: 'BA872' },
            { from: 'BUD', to: 'BEG', date: '2025-11-27', flight: 'JU143' },
            { from: 'BEG', to: 'OTP', date: '2025-11-30', flight: 'JU102' },
            { from: 'OTP', to: 'LHR', date: '2025-12-03', flight: 'BA889' },
            { from: 'LHR', to: 'SFO', date: '2025-12-03', flight: 'BA285' },
        ];

        // Calculate distance between two points (Haversine formula)
        function getDistance(lat1, lon1, lat2, lon2) {
            const R = 3959; // Earth's radius in miles
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                      Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                      Math.sin(dLon/2) * Math.sin(dLon/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }

        // Generate arc points for curved flight path
        function getArcPoints(from, to, numPoints = 50) {
            const points = [];
            for (let i = 0; i <= numPoints; i++) {
                const t = i / numPoints;
                const lat = from.lat + t * (to.lat - from.lat);
                let lon = from.lon + t * (to.lon - from.lon);

                // Handle crossing the date line
                if (Math.abs(to.lon - from.lon) > 180) {
                    if (from.lon > to.lon) {
                        lon = from.lon + t * (to.lon + 360 - from.lon);
                        if (lon > 180) lon -= 360;
                    } else {
                        lon = from.lon + t * (to.lon - 360 - from.lon);
                        if (lon < -180) lon += 360;
                    }
                }

                // Add arc curvature
                const arc = Math.sin(t * Math.PI) * 0.15 * getDistance(from.lat, from.lon, to.lat, to.lon) / 1000;
                points.push([lat + arc, lon]);
            }
            return points;
        }

        // Initialize map with better touch/responsive options
        const map = L.map('map', {
            zoomControl: false,
            attributionControl: false,
            worldCopyJump: true,
            tap: true,
            touchZoom: true,
            dragging: true,
            scrollWheelZoom: false, // Prevent accidental zoom while scrolling
            doubleClickZoom: true,
            minZoom: 1,
            maxZoom: 10
        }).setView([30, 0], 2);

        // Dark map tiles
        L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_nolabels/{z}/{x}/{y}{r}.png', {
            maxZoom: 19,
            noWrap: false
        }).addTo(map);

        // Handle resize - recalculate map size
        const mapContainer = document.getElementById('map');
        const resizeObserver = new ResizeObserver(() => {
            map.invalidateSize();
        });
        resizeObserver.observe(mapContainer);

        // Also handle orientation change on mobile
        window.addEventListener('orientationchange', () => {
            setTimeout(() => map.invalidateSize(), 100);
        });

        // Track unique airports and total miles
        const visitedAirports = new Set();
        let totalMiles = 0;

        // Draw flights
        flights.forEach(flight => {
            const from = airports[flight.from];
            const to = airports[flight.to];

            if (!from || !to) {
                console.warn(`Unknown airport: ${flight.from} or ${flight.to}`);
                return;
            }

            visitedAirports.add(flight.from);
            visitedAirports.add(flight.to);
            totalMiles += getDistance(from.lat, from.lon, to.lat, to.lon);

            // Draw arc
            const arcPoints = getArcPoints(from, to);
            L.polyline(arcPoints, {
                color: '#64b5f6',
                weight: 1.5,
                opacity: 0.7
            }).addTo(map);

            // Add airport markers
            [from, to].forEach(airport => {
                L.circleMarker([airport.lat, airport.lon], {
                    radius: 4,
                    fillColor: '#64b5f6',
                    fillOpacity: 1,
                    color: '#fff',
                    weight: 1
                }).addTo(map);
            });
        });

        // Fit map to show all flights
        if (flights.length > 0) {
            const allPoints = flights.flatMap(f => {
                const from = airports[f.from];
                const to = airports[f.to];
                return from && to ? [[from.lat, from.lon], [to.lat, to.lon]] : [];
            });
            if (allPoints.length > 0) {
                map.fitBounds(allPoints, { padding: [30, 30] });
            }
        }

        // Update stats
        document.getElementById('total-flights').textContent = flights.length;
        document.getElementById('total-miles').textContent = Math.round(totalMiles).toLocaleString();
        document.getElementById('total-airports').textContent = visitedAirports.size;

        // Populate flights list
        const flightsList = document.getElementById('flights-list');
        flights.sort((a, b) => new Date(b.date) - new Date(a.date)).forEach(flight => {
            const item = document.createElement('div');
            item.className = 'flight-item';
            item.innerHTML = `
                <div class="flight-route">
                    <span class="flight-code">${flight.from}</span>
                    <span class="flight-arrow">→</span>
                    <span class="flight-code">${flight.to}</span>
                </div>
                <div class="flight-date">${new Date(flight.date).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}</div>
            `;
            flightsList.appendChild(item);
        });
    </script>
</body>
</html>
