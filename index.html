<!-- filename: index.html -->
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>shag.lol üòÅ bounce</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
      :root { color-scheme: light dark; }
      html, body { height: 100%; margin: 0; }
      body {
        display: grid;
        place-items: center;
        font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
        background: Canvas;
        color: CanvasText;
        overflow: hidden;
      }
      #canvas {
        position: fixed;
        inset: 0;
        pointer-events: none;
      }
      .emoji {
        position: absolute;
        font-size: 32px;
        line-height: 1;
        user-select: none;
        will-change: transform;
      }
      #starter {
        font-size: 96px;
        cursor: default;
        user-select: none;
        z-index: 10;
      }
      #counter {
        position: fixed;
        right: 12px;
        bottom: 10px;
        font-size: 14px;
        line-height: 1;
        opacity: 0;
        transition: opacity 180ms ease;
        z-index: 20;
        user-select: none;
      }
      .dottext {
        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
        letter-spacing: 2px;
        color: CanvasText;
        text-shadow:
          0 0 0 CanvasText,
          0.06em 0 CanvasText,
          0.12em 0 CanvasText,
          0.18em 0 CanvasText;
        filter: contrast(1.1) saturate(1);
      }
      @media (prefers-reduced-motion: reduce) {
        .emoji { transition: none !important; }
        #counter { transition: none !important; }
      }
    </style>
  </head>
  <body>
    <div id="starter" aria-label="shag.lol">üòÅ</div>
    <div id="canvas" aria-hidden="true"></div>
    <div id="counter" class="dottext" aria-live="polite" aria-atomic="true" role="status">0</div>

    <script>
      const COUNT = 100;
      const SIZE = 32;
      const MIN_SPEED = 100;
      const MAX_SPEED = 300;

      const emojis = [];
      let rafId = null;
      let lastTs = null;
      let bounds = { w: window.innerWidth, h: window.innerHeight };
      let running = false;
      let activated = false;

      const starter = document.getElementById('starter');
      const canvas = document.getElementById('canvas');
      const counter = document.getElementById('counter');

      function rand(min, max) { return Math.random() * (max - min) + min; }
      function updateCounter() { counter.textContent = String(emojis.length); }
      function showCounter() { counter.style.opacity = '1'; }

      function createEmoji() {
        const el = document.createElement('div');
        el.className = 'emoji';
        el.textContent = 'üòÅ';
        const x = rand(0, Math.max(0, bounds.w - SIZE));
        const y = rand(0, Math.max(0, bounds.h - SIZE));
        const angle = rand(0, Math.PI * 2);
        const speed = rand(MIN_SPEED, MAX_SPEED);
        const vx = Math.cos(angle) * speed;
        const vy = Math.sin(angle) * speed;
        canvas.appendChild(el);
        el.style.transform = `translate(${x}px, ${y}px)`;
        return { el, x, y, vx, vy, size: SIZE };
      }

      function spawnN(n) {
        const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
        const startIndex = emojis.length;
        for (let i = 0; i < n; i++) {
          const e = createEmoji();
          emojis.push(e);
          if (prefersReduced) {
            const cols = Math.max(1, Math.floor(bounds.w / (SIZE + 8)));
            const row = Math.floor((startIndex + i) / cols);
            const col = (startIndex + i) % cols;
            e.x = col * (SIZE + 8) + 8;
            e.y = row * (SIZE + 8) + 8;
            e.vx = 0;
            e.vy = 0;
            e.el.style.transform = `translate(${e.x}px, ${e.y}px)`;
          }
        }
        updateCounter();
        if (!prefersReduced) start();
      }

      function start() {
        if (running) return;
        running = true;
        lastTs = performance.now();
        rafId = requestAnimationFrame(tick);
      }

      function stop() {
        running = false;
        if (rafId) cancelAnimationFrame(rafId);
        rafId = null;
      }

      function tick(ts) {
        const dt = Math.min(0.05, (ts - lastTs) / 1000);
        lastTs = ts;
        const w = bounds.w;
        const h = bounds.h;
        for (const e of emojis) {
          e.x += e.vx * dt;
          e.y += e.vy * dt;
          if (e.x <= 0) { e.x = 0; e.vx = Math.abs(e.vx); }
          if (e.x + e.size >= w) { e.x = w - e.size; e.vx = -Math.abs(e.vx); }
          if (e.y <= 0) { e.y = 0; e.vy = Math.abs(e.vy); }
          if (e.y + e.size >= h) { e.y = h - e.size; e.vy = -Math.abs(e.vy); }
          e.el.style.transform = `translate(${e.x}px, ${e.y}px)`;
        }
        rafId = requestAnimationFrame(tick);
      }

      function onResize() {
        bounds.w = window.innerWidth;
        bounds.h = window.innerHeight;
        for (const e of emojis) {
          e.x = Math.min(Math.max(0, e.x), Math.max(0, bounds.w - e.size));
          e.y = Math.min(Math.max(0, e.y), Math.max(0, bounds.h - e.size));
          e.el.style.transform = `translate(${e.x}px, ${e.y}px)`;
        }
      }
      window.addEventListener('resize', onResize);

      function activate() {
        if (activated) return;
        activated = true;
        starter.style.display = 'none';
        canvas.style.pointerEvents = 'none';
        showCounter();
        spawnN(COUNT);
      }

      const KONAMI = ['ArrowUp','ArrowUp','ArrowDown','ArrowDown','ArrowLeft','ArrowRight','ArrowLeft','ArrowRight','b','a'];
      let keys = [];
      window.addEventListener('keydown', (e) => {
        const k = e.key.length === 1 ? e.key.toLowerCase() : e.key;
        keys.push(k);
        if (keys.length > KONAMI.length) keys.shift();
        const match = KONAMI.every((code, i) => code === keys[i]);
        if (match) activate();
      });

      let lastClick = 0;
      starter.addEventListener('click', () => {
        const now = performance.now();
        if (now - lastClick < 300) activate();
        lastClick = now;
      });

      document.addEventListener('click', (e) => {
        if (!activated) return;
        const burst = 10;
        const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
        for (let i = 0; i < burst; i++) {
          const obj = createEmoji();
          obj.x = (e.clientX || bounds.w / 2) - SIZE / 2;
          obj.y = (e.clientY || bounds.h / 2) - SIZE / 2;
          obj.el.style.transform = `translate(${obj.x}px, ${obj.y}px)`;
          emojis.push(obj);
        }
        updateCounter();
        if (!running && !prefersReduced) start();
      });

      document.addEventListener('visibilitychange', () => {
        if (document.hidden) stop();
        else if (emojis.length && !window.matchMedia('(prefers-reduced-motion: reduce)').matches) start();
      });
    </script>
  </body>
</html>
